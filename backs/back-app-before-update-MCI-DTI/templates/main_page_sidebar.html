{# templates/partials/sidebar.html #}
{% block sidebar %}
<aside class="sidebar bg-light border-right p-3">
	<div class="d-flex align-items-center justify-content-between mb-2">
		<h5 class="mb-0">EcuapassDocs {{ release }}</h5>
	</div>
	<hr class="sidebar-separator">

	<ul class="list-unstyled mb-0">
		{% if not user.is_authenticated %}
		<li>
			<a href="{% url 'login' %}?next={{ request.path }}">Iniciar</a>
		</li>
		{% else %}
			<hr class="sidebar-separator">

			{# Helper to detect active section by url_name #}
			{% with current=request.resolver_match.url_name %}
			<!-- Cartas de Porte -->
			<a class="nav-link p-0 mb-1"
			   href="#cartaporte"
			   data-bs-toggle="collapse"			{# Bootstrap 5: data-bs-toggle #}
			   aria-expanded="{% if current in 'cartaporte cartaporte-listado' %}true{% else %}false{% endif %}"
			   aria-controls="cartaporte">
				▸ Cartas de Porte
			</a>
			<div id="cartaporte"
				 class="collapse {% if current in 'cartaporte cartaporte-listado' %}show{% endif %}">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'cartaporte' %}active{% endif %}"
						   href="{% url 'cartaporte' %}{{ 'nuevodoc' }}" target="_blank">
							Nuevo
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'cartaporte-listado' %}active{% endif %}"
						   href="{% url 'cartaporte-listado' %}">
							Listar
						</a>
					</li>
				</ul>
			</div>

			<!-- Manifiestos -->
			<a class="nav-link p-0 mb-1"
			   href="#manifiesto"
			   data-bs-toggle="collapse"
			   aria-expanded="{% if current in 'manifiesto manifiesto-listado' %}true{% else %}false{% endif %}"
			   aria-controls="manifiesto">
				▸ Manifiestos
			</a>
			<div id="manifiesto"
				 class="collapse {% if current in 'manifiesto manifiesto-listado' %}show{% endif %}">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'manifiesto' %}active{% endif %}"
						   href="{% url 'manifiesto' %}{{ 'nuevodoc' }}" target="_blank">
							Nuevo
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'manifiesto-listado' %}active{% endif %}"
						   href="{% url 'manifiesto-listado' %}">
							Listar
						</a>
					</li>
				</ul>
			</div>

			<!-- Declaraciones -->
			<a class="nav-link p-0 mb-1"
			   href="#declaracion"
			   data-bs-toggle="collapse"
			   aria-expanded="{% if current in 'declaracion declaracion-listado' %}true{% else %}false{% endif %}"
			   aria-controls="declaracion">
				▸ Declaraciones
			</a>
			<div id="declaracion"
				 class="collapse {% if current in 'declaracion declaracion-listado' %}show{% endif %}">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'declaracion' %}active{% endif %}"
						   href="{% url 'declaracion' %}{{ 'nuevodoc' }}" target="_blank">
							Nuevo
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'declaracion-listado' %}active{% endif %}"
						   href="{% url 'declaracion-listado' %}">
							Listar
						</a>
					</li>
				</ul>
			</div>

			<hr class="sidebar-separator">

			<!-- Entidades -->
			<a class="nav-link p-0 mb-1"
			   href="#entidades"
			   data-bs-toggle="collapse"
			   aria-expanded="{% if current in 'clientes vehiculos conductores' %}true{% else %}false{% endif %}"
			   aria-controls="entidades">
				▸ Entidades
			</a>
			<div id="entidades"
				 class="collapse {% if current in 'clientes vehiculos conductores' %}show{% endif %}">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'clientes' %}active{% endif %}"
						   href="{% url 'clientes' %}">
							Clientes
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'vehiculos' %}active{% endif %}"
						   href="{% url 'vehiculos' %}">
							Vehículos
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'conductores' %}active{% endif %}"
						   href="{% url 'conductores' %}">
							Conductores
						</a>
					</li>
				</ul>
			</div>

			<hr class="sidebar-separator">
				{% include 'main_page_userinfo.html' %}

				<form method="post" action="{% url 'logout' %}" class="mb-3">
					{% csrf_token %}
					<button type="submit" class="btn btn-sm btn-outline-secondary btn-block">
						Cerrar sesión
					</button>
				</form>

			  <!-- Usuario -->
			  <a class="nav-link p-0 mb-1"
				 href="#usuario"
				 data-bs-toggle="collapse"
				 aria-expanded="false"
				aria-controls="usuario">
				 ▸ Usuario
			</a>
			<div id="usuario" class="collapse">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0" href="{% url 'password' %}">Cambiar contraseña</a>
					</li>
				</ul>
			</div>

			{% if user.es_director or user.is_staff %}
			<hr class="sidebar-separator">
			<!-- Administración -->
			<a class="nav-link p-0 mb-1"
			   href="#administracion"
			   data-bs-toggle="collapse"
			   aria-expanded="{% if current in 'usuarios reportes' %}true{% else %}false{% endif %}"
			   aria-controls="administracion">
				▸ Administración
			</a>
			<div id="administracion"
				 class="collapse {% if current in 'usuarios reportes' %}show{% endif %}">
				<ul class="nav flex-column ml-3 mb-2">
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'usuarios' %}active{% endif %}"
						   href="{% url 'usuarios' %}">
							Usuarios y Entidades
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-1 px-0 {% if current == 'reportes' %}active{% endif %}"
						   href="{% url 'reportes' %}">
							Reportes y Respaldos
						</a>
					</li>
				</ul>
			</div>
		{% endif %}
		{% endwith %}
		{% endif %}
	</ul>
</aside>
{% endblock %}

